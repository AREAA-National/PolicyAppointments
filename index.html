<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appointment Manager</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // ========================================
        // AIRTABLE CONFIGURATION
        // PASTE YOUR CREDENTIALS HERE:
        // ========================================
        const AIRTABLE_TOKEN = 'patndkqeEgUuz8olF.d6ec97a9303fff72699778343b6feabdffdcec3e6017f4f8feb494beae8fe9e5';  // Starts with 'pat...'
        const AIRTABLE_BASE_ID = 'appcIA047ZEavf531';              // Starts with 'app...'
        const AIRTABLE_TABLE_NAME = 'Appointments';
        // ========================================

        // Airtable API wrapper
        const airtable = {
            async getAll() {
                try {
                    const response = await fetch(
                        `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}?sort%5B0%5D%5Bfield%5D=date&sort%5B0%5D%5Bdirection%5D=asc`,
                        {
                            headers: {
                                'Authorization': `Bearer ${AIRTABLE_TOKEN}`,
                                'Content-Type': 'application/json'
                            }
                        }
                    );
                    
                    if (!response.ok) {
                        throw new Error(`Airtable error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return data.records.map(record => ({
                        id: record.id,
                        ...record.fields
                    }));
                } catch (error) {
                    console.error('Error fetching from Airtable:', error);
                    alert('Error loading meetings. Check your Airtable credentials.');
                    return [];
                }
            },

            async create(fields) {
                try {
                    const response = await fetch(
                        `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}`,
                        {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${AIRTABLE_TOKEN}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ fields })
                        }
                    );
                    
                    if (!response.ok) {
                        throw new Error(`Airtable error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return {
                        id: data.id,
                        ...data.fields
                    };
                } catch (error) {
                    console.error('Error creating record:', error);
                    alert('Error saving meeting. Please try again.');
                    return null;
                }
            },

            async update(id, fields) {
                try {
                    const response = await fetch(
                        `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}/${id}`,
                        {
                            method: 'PATCH',
                            headers: {
                                'Authorization': `Bearer ${AIRTABLE_TOKEN}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ fields })
                        }
                    );
                    
                    if (!response.ok) {
                        throw new Error(`Airtable error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return {
                        id: data.id,
                        ...data.fields
                    };
                } catch (error) {
                    console.error('Error updating record:', error);
                    alert('Error updating meeting. Please try again.');
                    return null;
                }
            },

            async delete(id) {
                try {
                    const response = await fetch(
                        `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${AIRTABLE_TABLE_NAME}/${id}`,
                        {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${AIRTABLE_TOKEN}`,
                                'Content-Type': 'application/json'
                            }
                        }
                    );
                    
                    if (!response.ok) {
                        throw new Error(`Airtable error: ${response.status}`);
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Error deleting record:', error);
                    alert('Error deleting meeting. Please try again.');
                    return false;
                }
            }
        };

        function AppointmentManager() {
            const [view, setView] = useState('public'); // 'public' or 'admin'
            const [appointments, setAppointments] = useState([]);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [password, setPassword] = useState('');
            const [loading, setLoading] = useState(true);
            
            // Admin password - change this to whatever you want
            const ADMIN_PASSWORD = 'admin123';

            // Load appointments on mount
            useEffect(() => {
                loadAppointments();
            }, []);

            const loadAppointments = async () => {
                setLoading(true);
                const data = await airtable.getAll();
                setAppointments(data);
                setLoading(false);
            };

            const handleLogin = () => {
                if (password === ADMIN_PASSWORD) {
                    setIsAuthenticated(true);
                    setPassword('');
                } else {
                    alert('Incorrect password');
                }
            };

            const handleLogout = () => {
                setIsAuthenticated(false);
                setView('public');
            };

            const addAppointment = async (appointment) => {
                const newRecord = await airtable.create(appointment);
                if (newRecord) {
                    setAppointments(prev => [...prev, newRecord]);
                    return newRecord;
                }
                return false;
            };

            const updateAppointment = async (id, updatedData) => {
                const updated = await airtable.update(id, updatedData);
                if (updated) {
                    setAppointments(appointments.map(apt => 
                        apt.id === id ? updated : apt
                    ));
                }
            };

            const deleteAppointment = async (id) => {
                const success = await airtable.delete(id);
                if (success) {
                    setAppointments(appointments.filter(apt => apt.id !== id));
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-amber-50 to-orange-100">
                    {/* Header */}
                    <header className="bg-white shadow-md">
                        <div className="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8">
                            <div className="flex justify-between items-center">
                                <h1 className="text-3xl font-bold" style={{color: '#A1692e'}}>
                                    <i className="fas fa-calendar-alt mr-3"></i>
                                    Meeting Schedule
                                </h1>
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => setView('public')}
                                        className={`px-4 py-2 rounded-lg font-medium transition ${
                                            view === 'public'
                                                ? 'text-white'
                                                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                        }`}
                                        style={view === 'public' ? {backgroundColor: '#A1692e'} : {}}
                                    >
                                        <i className="fas fa-eye mr-2"></i>Public View
                                    </button>
                                    {!isAuthenticated ? (
                                        <button
                                            onClick={() => setView('admin')}
                                            className={`px-4 py-2 rounded-lg font-medium transition ${
                                                view === 'admin'
                                                    ? 'text-white'
                                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                            }`}
                                            style={view === 'admin' ? {backgroundColor: '#A1692e'} : {}}
                                        >
                                            <i className="fas fa-lock mr-2"></i>Admin
                                        </button>
                                    ) : (
                                        <button
                                            onClick={handleLogout}
                                            className="px-4 py-2 rounded-lg font-medium bg-red-500 text-white hover:bg-red-600 transition"
                                        >
                                            <i className="fas fa-sign-out-alt mr-2"></i>Logout
                                        </button>
                                    )}
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
                        {loading ? (
                            <div className="text-center py-12">
                                <i className="fas fa-spinner fa-spin text-4xl" style={{color: '#A6192E'}}></i>
                                <p className="mt-4 text-gray-600">Loading appointments...</p>
                            </div>
                        ) : view === 'public' ? (
                            <PublicCalendar appointments={appointments} />
                        ) : isAuthenticated ? (
                            <AdminDashboard
                                appointments={appointments}
                                onAdd={addAppointment}
                                onUpdate={updateAppointment}
                                onDelete={deleteAppointment}
                                onReload={loadAppointments}
                            />
                        ) : (
                            <LoginForm
                                password={password}
                                setPassword={setPassword}
                                onLogin={handleLogin}
                            />
                        )}
                    </main>
                </div>
            );
        }

        function LoginForm({ password, setPassword, onLogin }) {
            return (
                <div className="max-w-md mx-auto mt-12">
                    <div className="bg-white rounded-xl shadow-lg p-8">
                        <div className="text-center mb-6">
                            <i className="fas fa-shield-alt text-5xl mb-4" style={{color: '#A6192E'}}></i>
                            <h2 className="text-2xl font-bold text-gray-800">Admin Access</h2>
                            <p className="text-gray-600 mt-2">Enter password to manage appointments</p>
                        </div>
                        <div className="space-y-4">
                            <input
                                type="password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && onLogin()}
                                placeholder="Enter password"
                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent"
                                style={{'--tw-ring-color': '#A1692e'}}
                            />
                            <button
                                onClick={onLogin}
                                className="w-full text-white py-3 rounded-lg font-medium transition hover:opacity-90"
                                style={{backgroundColor: '#A6192E'}}
                            >
                                <i className="fas fa-sign-in-alt mr-2"></i>Login
                            </button>
                            <p className="text-sm text-gray-500 text-center mt-4">
                                Default password: <code className="bg-gray-100 px-2 py-1 rounded">admin123</code>
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        function PublicCalendar({ appointments }) {
            const [viewMode, setViewMode] = useState('upcoming'); // 'upcoming' or 'all'
            const [searchTerm, setSearchTerm] = useState('');
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const sortedAppointments = [...appointments].sort((a, b) => 
                new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time)
            );

            const upcomingAppointments = sortedAppointments.filter(apt => 
                new Date(apt.date) >= today
            );

            // Filter appointments based on search term
            const filterAppointments = (apts) => {
                if (!searchTerm.trim()) return apts;
                
                const search = searchTerm.toLowerCase().trim();
                return apts.filter(apt => {
                    const senatorMatch = apt.senatorName?.toLowerCase().includes(search);
                    const repMatch = apt.representativeName?.toLowerCase().includes(search);
                    const stateMatch = apt.state?.toLowerCase().includes(search);
                    const zipcodeMatch = apt.zipcode?.includes(search);
                    
                    return senatorMatch || repMatch || stateMatch || zipcodeMatch;
                });
            };

            const baseAppointments = viewMode === 'upcoming' ? upcomingAppointments : sortedAppointments;
            const displayAppointments = filterAppointments(baseAppointments);

            // Group by date
            const groupedByDate = displayAppointments.reduce((acc, apt) => {
                if (!acc[apt.date]) {
                    acc[apt.date] = [];
                }
                acc[apt.date].push(apt);
                return acc;
            }, {});

            return (
                <div>
                    <div className="mb-6">
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-2xl font-bold text-gray-800">
                                {viewMode === 'upcoming' ? 'Upcoming Meetings' : 'All Meetings'}
                            </h2>
                            <div className="flex gap-2">
                                <button
                                    onClick={() => setViewMode('upcoming')}
                                    className={`px-4 py-2 rounded-lg font-medium transition ${
                                        viewMode === 'upcoming'
                                            ? 'text-white'
                                            : 'bg-white text-gray-700 hover:bg-gray-100'
                                    }`}
                                    style={viewMode === 'upcoming' ? {backgroundColor: '#A6192E'} : {}}
                                >
                                    Upcoming
                                </button>
                                <button
                                    onClick={() => setViewMode('all')}
                                    className={`px-4 py-2 rounded-lg font-medium transition ${
                                        viewMode === 'all'
                                            ? 'text-white'
                                            : 'bg-white text-gray-700 hover:bg-gray-100'
                                    }`}
                                    style={viewMode === 'all' ? {backgroundColor: '#A6192E'} : {}}
                                >
                                    All
                                </button>
                            </div>
                        </div>
                        
                        {/* Search Bar */}
                        <div className="relative">
                            <input
                                type="text"
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                                placeholder="Search by Senator, Representative, State, or Zipcode..."
                                className="w-full px-4 py-3 pl-12 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent shadow-sm"
                                style={{'--tw-ring-color': '#A6192E'}}
                            />
                            <i className="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            {searchTerm && (
                                <button
                                    onClick={() => setSearchTerm('')}
                                    className="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600"
                                >
                                    <i className="fas fa-times"></i>
                                </button>
                            )}
                        </div>
                        
                        {searchTerm && (
                            <p className="mt-2 text-sm text-gray-600">
                                Found {displayAppointments.length} meeting{displayAppointments.length !== 1 ? 's' : ''} matching "{searchTerm}"
                            </p>
                        )}
                    </div>

                    {displayAppointments.length === 0 ? (
                        <div className="bg-white rounded-xl shadow-md p-12 text-center">
                            <i className="fas fa-calendar-times text-6xl text-gray-300 mb-4"></i>
                            <p className="text-xl text-gray-600">
                                {searchTerm ? `No meetings found matching "${searchTerm}"` : 'No meetings scheduled'}
                            </p>
                            {searchTerm && (
                                <button
                                    onClick={() => setSearchTerm('')}
                                    className="mt-4 px-6 py-2 rounded-lg font-medium text-white transition hover:opacity-90"
                                    style={{backgroundColor: '#A6192E'}}
                                >
                                    Clear Search
                                </button>
                            )}
                        </div>
                    ) : (
                        <div className="space-y-6">
                            {Object.keys(groupedByDate).map(date => (
                                <div key={date} className="bg-white rounded-xl shadow-md overflow-hidden">
                                    <div className="text-white px-6 py-3" style={{backgroundColor: '#A6192E'}}>
                                        <h3 className="text-lg font-bold">
                                            <i className="far fa-calendar mr-2"></i>
                                            {new Date(date).toLocaleDateString('en-US', { 
                                                weekday: 'long', 
                                                year: 'numeric', 
                                                month: 'long', 
                                                day: 'numeric' 
                                            })}
                                        </h3>
                                    </div>
                                    <div className="divide-y divide-gray-200">
                                        {groupedByDate[date].map(apt => (
                                            <div key={apt.id} className="p-6 hover:bg-gray-50 transition">
                                                <div className="flex justify-between items-start">
                                                    <div className="flex-1">
                                                        <h4 className="text-xl font-bold text-gray-800 mb-2">
                                                            {apt.state} - {apt.representativeName || apt.senatorName}
                                                        </h4>
                                                        <div className="space-y-1 text-gray-600">
                                                            <p>
                                                                <i className="far fa-clock mr-2" style={{color: '#A6192E'}}></i>
                                                                <strong>Time:</strong> {apt.time}
                                                            </p>
                                                            {apt.representativeName && (
                                                                <p>
                                                                    <i className="fas fa-user-tie mr-2" style={{color: '#A6192E'}}></i>
                                                                    <strong>Representative:</strong> {apt.representativeName}
                                                                </p>
                                                            )}
                                                            {apt.senatorName && (
                                                                <p>
                                                                    <i className="fas fa-user-tie mr-2" style={{color: '#A6192E'}}></i>
                                                                    <strong>Senator:</strong> {apt.senatorName}
                                                                </p>
                                                            )}
                                                            {apt.attendees && (
                                                                <p>
                                                                    <i className="fas fa-users mr-2" style={{color: '#A6192E'}}></i>
                                                                    <strong>Attendees:</strong> {apt.attendees}
                                                                </p>
                                                            )}
                                                            {apt.zipcode && (
                                                                <p>
                                                                    <i className="fas fa-map-pin mr-2" style={{color: '#A6192E'}}></i>
                                                                    <strong>Zipcode:</strong> {apt.zipcode}
                                                                </p>
                                                            )}
                                                            {apt.staffer && (
                                                                <p>
                                                                    <i className="fas fa-user mr-2" style={{color: '#A6192E'}}></i>
                                                                    <strong>Staffer:</strong> {apt.staffer}
                                                                </p>
                                                            )}
                                                            {apt.meetingStatus && (
                                                                <p>
                                                                    <i className="fas fa-info-circle mr-2" style={{color: '#A6192E'}}></i>
                                                                    <strong>Status:</strong> {apt.meetingStatus}
                                                                </p>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        // CSV/Excel utility functions
        const FIELDS = ['date','time','state','representativeName','senatorName','attendees','zipcode','staffer','meetingStatus'];
        const FIELD_LABELS = ['Date','Time','State','Representative Name','Senator Name','Attendees','Zipcode','Staffer','Meeting Status'];

        function parseCSV(text) {
            const lines = text.trim().split('\n').map(l => l.trim()).filter(Boolean);
            if (lines.length < 2) return [];
            const headers = lines[0].split(',').map(h => h.trim().replace(/^"|"$/g, '').trim());
            const records = [];
            for (let i = 1; i < lines.length; i++) {
                const values = [];
                let current = '';
                let inQuotes = false;
                for (let c = 0; c < lines[i].length; c++) {
                    const ch = lines[i][c];
                    if (ch === '"') { inQuotes = !inQuotes; }
                    else if (ch === ',' && !inQuotes) { values.push(current.trim()); current = ''; }
                    else { current += ch; }
                }
                values.push(current.trim());
                const record = {};
                headers.forEach((h, idx) => {
                    // Match header to field name (case-insensitive, ignore spaces)
                    const normalized = h.toLowerCase().replace(/\s/g, '');
                    const match = FIELDS.find(f => f.toLowerCase() === normalized) ||
                                  FIELD_LABELS.find((l, li) => l.toLowerCase().replace(/\s/g,'') === normalized ? FIELDS[li] : null);
                    const fieldName = FIELDS.find(f => f.toLowerCase() === normalized) ||
                                      (() => { const li = FIELD_LABELS.findIndex(l => l.toLowerCase().replace(/\s/g,'') === normalized); return li >= 0 ? FIELDS[li] : h; })();
                    record[fieldName] = values[idx] || '';
                });
                if (record.date || record.state) records.push(record);
            }
            return records;
        }

        function exportToCSV(appointments) {
            const rows = [FIELD_LABELS.join(',')];
            appointments.forEach(apt => {
                const row = FIELDS.map(f => {
                    const val = apt[f] || '';
                    return val.includes(',') ? `"${val}"` : val;
                });
                rows.push(row.join(','));
            });
            const blob = new Blob([rows.join('\n')], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `meetings_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportToExcel(appointments) {
            // Build an HTML table that Excel can open natively
            const headers = FIELD_LABELS.map(h => `<th>${h}</th>`).join('');
            const rows = appointments.map(apt => {
                const cells = FIELDS.map(f => `<td>${apt[f] || ''}</td>`).join('');
                return `<tr>${cells}</tr>`;
            }).join('');
            const html = `<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel"><head><meta charset="UTF-8"></head><body><table>${'<tr>' + headers + '</tr>'}${rows}</table></body></html>`;
            const blob = new Blob([html], { type: 'application/vnd.ms-excel' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `meetings_${new Date().toISOString().split('T')[0]}.xls`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function AdminDashboard({ appointments, onAdd, onUpdate, onDelete, onReload }) {
            const [isAdding, setIsAdding] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [importing, setImporting] = useState(false);
            const [importPreview, setImportPreview] = useState([]);
            const [importError, setImportError] = useState('');
            const [importSuccess, setImportSuccess] = useState('');

            const sortedAppointments = [...appointments].sort((a, b) => 
                new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time)
            );

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                setImportError('');
                setImportSuccess('');
                setImportPreview([]);

                const ext = file.name.split('.').pop().toLowerCase();
                if (!['csv', 'xls', 'xlsx'].includes(ext)) {
                    setImportError('Please upload a CSV or Excel (.xls, .xlsx) file.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const text = event.target.result;
                        const records = parseCSV(text);
                        if (records.length === 0) {
                            setImportError('No valid records found. Make sure your file has the correct column headers.');
                            return;
                        }
                        setImportPreview(records);
                    } catch (err) {
                        setImportError('Error reading file. Please make sure it is a valid CSV.');
                    }
                };
                reader.readAsText(file);
                // Reset file input
                e.target.value = '';
            };

            const handleConfirmImport = async () => {
                setImporting(true);
                let successCount = 0;
                for (const record of importPreview) {
                    const result = await onAdd(record);
                    if (result !== false) successCount++;
                }
                setImporting(false);
                setImportPreview([]);
                setImportSuccess(`âœ… Successfully imported ${successCount} meeting${successCount !== 1 ? 's' : ''}!`);
                setTimeout(() => setImportSuccess(''), 5000);
                if (onReload) onReload();
            };

            const handleCancelImport = () => {
                setImportPreview([]);
                setImportError('');
            };

            const downloadTemplate = () => {
                const rows = [FIELD_LABELS.join(','), '2026-03-15,09:00,California,Rep. John Smith,Sen. Jane Doe,"John, Mary",90210,Alex Johnson,Confirmed'];
                const blob = new Blob([rows.join('\n')], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'meetings_template.csv';
                a.click();
                URL.revokeObjectURL(url);
            };

            return (
                <div>
                    {/* Top Bar */}
                    <div className="flex flex-wrap justify-between items-center mb-6 gap-3">
                        <h2 className="text-2xl font-bold text-gray-800">
                            Manage Meetings ({appointments.length})
                        </h2>
                        <div className="flex flex-wrap gap-2">
                            {/* Import Button */}
                            <label className="cursor-pointer text-white px-4 py-2 rounded-lg font-medium transition hover:opacity-90 flex items-center gap-2" style={{backgroundColor: '#5b6abf'}}>
                                <i className="fas fa-file-import"></i>
                                Import CSV/Excel
                                <input type="file" accept=".csv,.xls,.xlsx" onChange={handleFileUpload} className="hidden" />
                            </label>

                            {/* Template Download */}
                            <button
                                onClick={downloadTemplate}
                                className="bg-gray-500 text-white px-4 py-2 rounded-lg font-medium transition hover:opacity-90 flex items-center gap-2"
                            >
                                <i className="fas fa-download"></i>
                                Template
                            </button>

                            {/* Export CSV */}
                            <button
                                onClick={() => exportToCSV(sortedAppointments)}
                                disabled={appointments.length === 0}
                                className="text-white px-4 py-2 rounded-lg font-medium transition hover:opacity-90 flex items-center gap-2 disabled:opacity-40"
                                style={{backgroundColor: '#228B22'}}
                            >
                                <i className="fas fa-file-csv"></i>
                                Export CSV
                            </button>

                            {/* Export Excel */}
                            <button
                                onClick={() => exportToExcel(sortedAppointments)}
                                disabled={appointments.length === 0}
                                className="text-white px-4 py-2 rounded-lg font-medium transition hover:opacity-90 flex items-center gap-2 disabled:opacity-40"
                                style={{backgroundColor: '#1a6b2a'}}
                            >
                                <i className="fas fa-file-excel"></i>
                                Export Excel
                            </button>

                            {/* Add New */}
                            <button
                                onClick={() => setIsAdding(true)}
                                className="text-white px-4 py-2 rounded-lg font-medium transition hover:opacity-90 flex items-center gap-2"
                                style={{backgroundColor: '#A1692e'}}
                            >
                                <i className="fas fa-plus"></i>
                                Add New Meeting
                            </button>
                        </div>
                    </div>

                    {/* Success Message */}
                    {importSuccess && (
                        <div className="mb-4 p-4 bg-green-100 border border-green-400 text-green-800 rounded-lg font-medium">
                            {importSuccess}
                        </div>
                    )}

                    {/* Import Error */}
                    {importError && (
                        <div className="mb-4 p-4 bg-red-100 border border-red-400 text-red-800 rounded-lg">
                            <i className="fas fa-exclamation-circle mr-2"></i>{importError}
                        </div>
                    )}

                    {/* Import Preview */}
                    {importPreview.length > 0 && (
                        <div className="mb-6 bg-white rounded-xl shadow-md overflow-hidden">
                            <div className="px-6 py-4 text-white flex justify-between items-center" style={{backgroundColor: '#5b6abf'}}>
                                <h3 className="text-lg font-bold">
                                    <i className="fas fa-eye mr-2"></i>
                                    Preview: {importPreview.length} meeting{importPreview.length !== 1 ? 's' : ''} ready to import
                                </h3>
                            </div>
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            {FIELD_LABELS.map(l => (
                                                <th key={l} className="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider whitespace-nowrap">{l}</th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-200">
                                        {importPreview.map((row, i) => (
                                            <tr key={i} className="hover:bg-gray-50">
                                                {FIELDS.map(f => (
                                                    <td key={f} className="px-3 py-2 text-gray-700 whitespace-nowrap">{row[f] || '-'}</td>
                                                ))}
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                            <div className="px-6 py-4 bg-gray-50 flex gap-3 justify-end">
                                <button
                                    onClick={handleCancelImport}
                                    className="px-5 py-2 bg-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-400 transition"
                                >
                                    <i className="fas fa-times mr-2"></i>Cancel
                                </button>
                                <button
                                    onClick={handleConfirmImport}
                                    disabled={importing}
                                    className="px-5 py-2 text-white rounded-lg font-medium transition hover:opacity-90 disabled:opacity-60"
                                    style={{backgroundColor: '#5b6abf'}}
                                >
                                    {importing ? (
                                        <><i className="fas fa-spinner fa-spin mr-2"></i>Importing...</>
                                    ) : (
                                        <><i className="fas fa-check mr-2"></i>Confirm Import</>
                                    )}
                                </button>
                            </div>
                        </div>
                    )}

                    {/* CSV Format Info */}
                    <div className="mb-6 p-4 bg-amber-50 border border-amber-200 rounded-lg text-sm text-amber-800">
                        <i className="fas fa-info-circle mr-2"></i>
                        <strong>Import format:</strong> CSV or Excel with headers: {FIELD_LABELS.join(', ')}. 
                        Click <strong>"Template"</strong> to download a sample file.
                    </div>

                    {isAdding && (
                        <AppointmentForm
                            onSave={(data) => {
                                onAdd(data);
                                setIsAdding(false);
                            }}
                            onCancel={() => setIsAdding(false)}
                        />
                    )}

                    <div className="space-y-4">
                        {sortedAppointments.map(apt => (
                            <div key={apt.id}>
                                {editingId === apt.id ? (
                                    <AppointmentForm
                                        appointment={apt}
                                        onSave={(data) => {
                                            onUpdate(apt.id, data);
                                            setEditingId(null);
                                        }}
                                        onCancel={() => setEditingId(null)}
                                    />
                                ) : (
                                    <div className="bg-white rounded-lg shadow-md p-6">
                                        <div className="flex justify-between items-start">
                                            <div className="flex-1">
                                                <h3 className="text-xl font-bold text-gray-800 mb-2">
                                                    {apt.state} - {apt.representativeName || apt.senatorName}
                                                </h3>
                                                <div className="grid grid-cols-2 gap-4 text-gray-600">
                                                    <p>
                                                        <i className="far fa-calendar mr-2" style={{color: '#A1692e'}}></i>
                                                        {new Date(apt.date).toLocaleDateString()}
                                                    </p>
                                                    <p>
                                                        <i className="far fa-clock mr-2" style={{color: '#A1692e'}}></i>
                                                        {apt.time}
                                                    </p>
                                                    {apt.state && (
                                                        <p>
                                                            <i className="fas fa-flag mr-2" style={{color: '#A1692e'}}></i>
                                                            {apt.state}
                                                        </p>
                                                    )}
                                                    {apt.representativeName && (
                                                        <p>
                                                            <i className="fas fa-user-tie mr-2" style={{color: '#A1692e'}}></i>
                                                            Rep: {apt.representativeName}
                                                        </p>
                                                    )}
                                                    {apt.senatorName && (
                                                        <p>
                                                            <i className="fas fa-user-tie mr-2" style={{color: '#A1692e'}}></i>
                                                            Sen: {apt.senatorName}
                                                        </p>
                                                    )}
                                                    {apt.attendees && (
                                                        <p>
                                                            <i className="fas fa-users mr-2" style={{color: '#A1692e'}}></i>
                                                            {apt.attendees}
                                                        </p>
                                                    )}
                                                    {apt.zipcode && (
                                                        <p>
                                                            <i className="fas fa-map-pin mr-2" style={{color: '#A1692e'}}></i>
                                                            {apt.zipcode}
                                                        </p>
                                                    )}
                                                    {apt.staffer && (
                                                        <p>
                                                            <i className="fas fa-user mr-2" style={{color: '#A1692e'}}></i>
                                                            {apt.staffer}
                                                        </p>
                                                    )}
                                                    {apt.meetingStatus && (
                                                        <p>
                                                            <i className="fas fa-info-circle mr-2" style={{color: '#A1692e'}}></i>
                                                            {apt.meetingStatus}
                                                        </p>
                                                    )}
                                                </div>
                                            </div>
                                            <div className="flex gap-2 ml-4">
                                                <button
                                                    onClick={() => setEditingId(apt.id)}
                                                    className="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition"
                                                >
                                                    <i className="fas fa-edit"></i>
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        if (window.confirm('Delete this meeting?')) {
                                                            onDelete(apt.id);
                                                        }
                                                    }}
                                                    className="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition"
                                                >
                                                    <i className="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        function AppointmentForm({ appointment, onSave, onCancel }) {
            const [formData, setFormData] = useState({
                date: appointment?.date || '',
                time: appointment?.time || '',
                state: appointment?.state || '',
                representativeName: appointment?.representativeName || '',
                senatorName: appointment?.senatorName || '',
                attendees: appointment?.attendees || '',
                zipcode: appointment?.zipcode || '',
                staffer: appointment?.staffer || '',
                meetingStatus: appointment?.meetingStatus || ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!formData.date || !formData.time || !formData.state) {
                    alert('Please fill in Date, Time, and State (required fields)');
                    return;
                }
                if (!formData.representativeName && !formData.senatorName) {
                    alert('Please fill in either Representative Name or Senator Name');
                    return;
                }
                onSave(formData);
            };

            const handleChange = (e) => {
                setFormData({
                    ...formData,
                    [e.target.name]: e.target.value
                });
            };

            const usStates = [
                'Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California', 'Colorado', 'Connecticut', 
                'Delaware', 'Florida', 'Georgia', 'Hawaii', 'Idaho', 'Illinois', 'Indiana', 'Iowa', 
                'Kansas', 'Kentucky', 'Louisiana', 'Maine', 'Maryland', 'Massachusetts', 'Michigan', 
                'Minnesota', 'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada', 'New Hampshire', 
                'New Jersey', 'New Mexico', 'New York', 'North Carolina', 'North Dakota', 'Ohio', 
                'Oklahoma', 'Oregon', 'Pennsylvania', 'Rhode Island', 'South Carolina', 'South Dakota', 
                'Tennessee', 'Texas', 'Utah', 'Vermont', 'Virginia', 'Washington', 'West Virginia', 
                'Wisconsin', 'Wyoming'
            ];

            return (
                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                    <h3 className="text-xl font-bold text-gray-800 mb-4">
                        {appointment ? 'Edit Meeting' : 'New Meeting'}
                    </h3>
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Date <span className="text-red-500">*</span>
                                </label>
                                <input
                                    type="date"
                                    name="date"
                                    value={formData.date}
                                    onChange={handleChange}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent"
                                    style={{'--tw-ring-color': '#A1692e'}}
                                    required
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Time <span className="text-red-500">*</span>
                                </label>
                                <input
                                    type="time"
                                    name="time"
                                    value={formData.time}
                                    onChange={handleChange}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent"
                                    style={{'--tw-ring-color': '#A1692e'}}
                                    required
                                />
                            </div>
                        </div>

                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                State <span className="text-red-500">*</span>
                            </label>
                            <select
                                name="state"
                                value={formData.state}
                                onChange={handleChange}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent"
                                style={{'--tw-ring-color': '#A1692e'}}
                                required
                            >
                                <option value="">Select a state</option>
                                {usStates.map(state => (
                                    <option key={state} value={state}>{state}</option>
                                ))}
                            </select>
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Representative Name
                                </label>
                                <input
                                    type="text"
                                    name="representativeName"
                                    value={formData.representativeName}
                                    onChange={handleChange}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent"
                                    style={{'--tw-ring-color': '#A1692e'}}
                                    placeholder="e.g., Rep. John Smith"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Senator Name
                                </label>
                                <input
                                    type="text"
                                    name="senatorName"
                                    value={formData.senatorName}
                                    onChange={handleChange}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent"
                                    style={{'--tw-ring-color': '#A1692e'}}
                                    placeholder="e.g., Sen. Jane Doe"
                                />
                            </div>
                        </div>

                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                Attendees
                            </label>
                            <input
                                type="text"
                                name="attendees"
                                value={formData.attendees}
                                onChange={handleChange}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent"
                                style={{'--tw-ring-color': '#A1692e'}}
                                placeholder="e.g., John, Mary, Michael"
                            />
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Zipcode
                                </label>
                                <input
                                    type="text"
                                    name="zipcode"
                                    value={formData.zipcode}
                                    onChange={handleChange}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent"
                                    style={{'--tw-ring-color': '#A1692e'}}
                                    placeholder="e.g., 90210"
                                    maxLength="10"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Staffer
                                </label>
                                <input
                                    type="text"
                                    name="staffer"
                                    value={formData.staffer}
                                    onChange={handleChange}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent"
                                    style={{'--tw-ring-color': '#A1692e'}}
                                    placeholder="Staffer name"
                                />
                            </div>
                        </div>

                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                Meeting Status
                            </label>
                            <select
                                name="meetingStatus"
                                value={formData.meetingStatus}
                                onChange={handleChange}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:border-transparent"
                                style={{'--tw-ring-color': '#A1692e'}}
                            >
                                <option value="">Select status</option>
                                <option value="Scheduled">Scheduled</option>
                                <option value="Confirmed">Confirmed</option>
                                <option value="Pending">Pending</option>
                                <option value="Completed">Completed</option>
                                <option value="Cancelled">Cancelled</option>
                            </select>
                        </div>

                        <div className="flex gap-3 pt-4">
                            <button
                                type="submit"
                                className="flex-1 text-white py-2 rounded-lg font-medium transition hover:opacity-90"
                                style={{backgroundColor: '#A1692e'}}
                            >
                                <i className="fas fa-save mr-2"></i>Save
                            </button>
                            <button
                                type="button"
                                onClick={onCancel}
                                className="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg font-medium hover:bg-gray-400 transition"
                            >
                                <i className="fas fa-times mr-2"></i>Cancel
                            </button>
                        </div>
                    </form>
                </div>
            );
        }

        ReactDOM.render(<AppointmentManager />, document.getElementById('root'));
    </script>
</body>
</html>
